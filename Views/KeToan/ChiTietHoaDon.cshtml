@model WebPetShop.Models.HoaDon

@{
    Layout = "~/Views/Shared/_LayoutKeToan.cshtml";
    ViewData["Title"] = "Chi tiết hóa đơn";
}

<style>

    /* ====================== STYLE KHI IN ====================== */
    @@media print {
        body *

    {
        visibility: hidden;
    }

    #invoice-area, #invoice-area * {
        visibility: visible !important;
    }

    #invoice-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 0;
        margin: 0;
    }

    .no-print {
        display: none !important;
    }

    /* Dấu mộc hiện khi in */
    .watermark {
        opacity: 0.25 !important;
        z-index: 999 !important;
    }

    }

    /* ====================== KHUNG HÓA ĐƠN ====================== */
    .invoice-wrapper {
        max-width: 750px;
        margin: auto;
        background: #fff;
        padding: 35px 40px;
        border-radius: 12px;
        border: 1px solid #e4e4e4;
        box-shadow: 0 0 15px #ddd;
        position: relative; /* Để watermark bám theo khung */
        overflow: hidden;
        font-family: "Segoe UI", sans-serif;
    }

    /* ====================== DẤU MỘC ĐỎ MỜ ====================== */
    .watermark {
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0.22;
        z-index: 10;
        pointer-events: none;
    }

        .watermark img {
            width: 300px;
            opacity: 0.25;
            filter: drop-shadow(0 0 2px #ff000050);
        }

    /* ====================== HEADER ====================== */
    .invoice-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 3px solid #dc3545;
        padding-bottom: 15px;
        margin-bottom: 25px;
    }

        .invoice-header h2 {
            color: #dc3545;
            font-weight: 700;
        }

    /* ====================== BẢNG ====================== */
    .table-clean th {
        width: 200px;
        background: #f8f9fa;
    }

    .table-clean td {
        font-size: 15px;
    }

    .section-title {
        font-size: 18px;
        font-weight: bold;
        color: #dc3545;
        margin-top: 30px;
        margin-bottom: 12px;
        border-left: 4px solid #dc3545;
        padding-left: 10px;
    }

    .table-items th {
        background: #ffe5e5;
        color: #9b0000;
    }

    .total-box {
        text-align: right;
        padding: 15px;
        margin-top: 20px;
        border-radius: 8px;
        background: #fff3f3;
        border: 2px dashed #dc3545;
        font-weight: bold;
        font-size: 20px;
        color: #d40000;
    }

    .signature {
        margin-top: 60px;
        text-align: right;
    }

</style>


<div class="container mt-4">

    <!-- Nút in -->
    <div class="no-print text-end mb-3">
        <button onclick="window.print()" class="btn btn-danger">
            <i class="fa-solid fa-print me-2"></i> In hóa đơn
        </button>
    </div>

    <!-- ====================== VÙNG IN ====================== -->
    <div id="invoice-area" class="invoice-wrapper">

        <!-- DẤU MỘC ĐỎ MỜ -->
        <div class="watermark">
            <img src="/ImagesWWeb/daumoc.jpg" />
        </div>

        <!-- HEADER -->
        <div class="invoice-header">
            <div class="title">
                <h2>HÓA ĐƠN THANH TOÁN</h2>
                <p>Mã hóa đơn: <strong>@Model.MaHd</strong></p>
                <p>Ngày lập: <strong>@Model.NgayLap?.ToString("dd/MM/yyyy HH:mm")</strong></p>
            </div>
        </div>

        <!-- THÔNG TIN HÓA ĐƠN -->
        <div class="section-title">Thông tin hóa đơn</div>

        <table class="table table-bordered table-clean">
            <tr><th>Mã hóa đơn</th><td>@Model.MaHd</td></tr>
            <tr><th>Người lập</th><td>@Model.MaKeToanNavigation?.HoTen</td></tr>
            <tr><th>Hình thức thanh toán</th><td>@Model.HinhThuc</td></tr>
            <tr><th>Ghi chú</th><td>@Model.GhiChu</td></tr>
        </table>

        <!-- ĐƠN HÀNG / KÝ GỬI -->
        @if (Model.MaDhNavigation != null)
        {
            <div class="section-title">Chi tiết đơn hàng</div>
            <table class="table table-bordered table-items">
                <thead>
                    <tr>
                        <th>Sản phẩm</th>
                        <th width="80">SL</th>
                        <th width="130">Đơn giá</th>
                        <th width="130">Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var ct in Model.MaDhNavigation.ChiTietDonHangs)
                    {
                        <tr>
                            <td>@ct.MaSpNavigation?.TenSp</td>
                            <td>@ct.SoLuong</td>
                            <td>@String.Format("{0:N0} ₫", ct.DonGia)</td>
                            <td>@String.Format("{0:N0} ₫", ct.SoLuong * ct.DonGia)</td>
                        </tr>
                    }
                </tbody>
            </table>
        }

        @if (Model.MaKyGuiNavigation != null)
        {
            <div class="section-title">Chi tiết ký gửi</div>
            <table class="table table-bordered table-clean">
                <tr><th>Khách hàng</th><td>@Model.MaKyGuiNavigation.MaKhNavigation?.HoTen</td></tr>
                <tr><th>Thú cưng</th><td>@Model.MaKyGuiNavigation.TenThuCung</td></tr>
                <tr><th>Ngày gửi</th><td>@Model.MaKyGuiNavigation.NgayGui?.ToString("dd/MM/yyyy")</td></tr>
                <tr><th>Ngày hết hạn</th><td>@Model.MaKyGuiNavigation.NgayHetHan?.ToString("dd/MM/yyyy")</td></tr>
            </table>
        }

        <!-- TỔNG TIỀN -->
        <div class="total-box">
            Tổng tiền: @String.Format("{0:N0} ₫", Model.SoTien)
        </div>

        <!-- CHỮ KÝ -->
        <div class="signature">
            <b>Kế toán ký tên</b><br />
            <i>(Ký và ghi rõ họ tên)</i>
        </div>

    </div>

    <a href="/KeToan/HoaDon" class="btn btn-secondary mt-3 no-print">
        <i class="fa-solid fa-arrow-left me-2"></i> Quay lại
    </a>

</div>
