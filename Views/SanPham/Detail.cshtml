@model WebPetShop.Models.SanPham
@using System.Globalization

@{
    ViewData["Title"] = Model.TenSp;

    // Lấy danh sách khuyến mãi từ ViewBag (controller phải truyền)
    var kmList = ViewBag.KhuyenMai as List<WebPetShop.Models.KhuyenMai>;
    var km = kmList?.FirstOrDefault(x => x.MaSP == Model.MaSp);
    var giaSauGiam = km != null ? Model.Gia - (Model.Gia * km.PhanTramGiam / 100) : Model.Gia;
}

<div class="container py-4">
    <div class="row gx-5">

        <!-- ✅ ẢNH SẢN PHẨM BÊN TRÁI -->
        <div class="col-lg-5 text-center">
            <img src="/ImagesWWeb/@Model.HinhAnh"
                 class="img-fluid rounded shadow"
                 style="max-height: 400px; object-fit: cover;">
        </div>

        <!-- ✅ THÔNG TIN SẢN PHẨM -->
        <div class="col-lg-7">
            <h2>@Model.TenSp</h2>

            <!-- Giá hiển thị: nếu có KM thì show giá sau giảm + gạch giá cũ -->
            <h3 class="text-danger fw-bold my-3">
                @String.Format("{0:N0} đ", giaSauGiam)
                @if (km != null)
                {
                    <span class="text-decoration-line-through text-secondary fs-6 ms-2">
                        @String.Format("{0:N0} đ", Model.Gia)
                    </span>
                }
            </h3>

            <p class="text-secondary">
                👉 Mô tả sản phẩm đang cập nhật... (Bạn có thể bổ sung mô tả thực tế sau)
            </p>

            <form method="get" asp-controller="GioHang" asp-action="Them">
                <input type="hidden" name="id" value="@Model.MaSp" />
                <input type="hidden" name="gia" value="@giaSauGiam" /> <!-- Gửi giá KM nếu có -->

                <label class="fw-bold me-2">Số lượng:</label>
                <input type="number" name="soLuong" value="1" min="1"
                       class="form-control d-inline-block"
                       style="width:80px; display:inline-block" />

                <div class="mt-4 d-flex gap-3">
                    <!-- ✅ THÊM GIỎ HÀNG -->
                    <button type="submit"
                            class="btn btn-warning text-dark fw-bold px-4 py-2 rounded-pill">
                        🛒 Thêm giỏ hàng
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    h2 {
        color: #1e3e62;
        font-weight: 700;
    }
</style>
